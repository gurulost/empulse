import{i as H,a as r,o as l,d as P,F as x,h as w,b as e,t as d,n as G,j as B,c as T,r as V,k as U,l as K,m as X,p as J,q as W,v as q,e as Q,f as j,s as Y}from"./app-BeGgamdR.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Z(){return{getDashboardData:async(t={})=>{const{data:i}=await H.get("/analytics/api/dashboard",{params:t});return i}}}const ee={name:"GapChart",props:{items:{type:Array,default:()=>[]}},methods:{formatNumber(s){return s==null?"—":Number(s).toFixed(1)},gapBadgeClass(s){return s==null?"bg-secondary":s>=0?"bg-danger":"bg-success"},barWidth(s){return!s||s.current===void 0||s.current===null?"0%":`${Math.max(0,Math.min(s.current/10*100,100))}%`}}},te={class:"gap-chart"},se={class:"d-flex justify-content-between align-items-center mb-1"},ae={class:"me-2 flex-grow-1"},le={class:"progress",style:{height:"8px"}},re={class:"text-muted"},ne={key:0,class:"text-muted mb-0"};function oe(s,t,i,v,u,o){return l(),r("div",te,[(l(!0),r(x,null,w(i.items,n=>(l(),r("div",{key:n.key??n.label,class:"mb-3"},[e("div",se,[e("strong",ae,d(n.label),1),e("span",{class:G(["badge",o.gapBadgeClass(n.gap)])},d(o.formatNumber(n.gap)),3)]),e("div",le,[e("div",{class:"progress-bar bg-primary",role:"progressbar",style:B({width:o.barWidth(n)})},null,4)]),e("small",re," Current "+d(o.formatNumber(n.current))+" / Ideal "+d(o.formatNumber(n.ideal)),1)]))),128)),i.items.length?P("",!0):(l(),r("p",ne,"No gap data available yet."))])}const ie=k(ee,[["render",oe]]),de={name:"ImpactSnapshot",props:{positive:{type:Number,default:null},importance:{type:Number,default:null},desire:{type:Number,default:null}},methods:{formatNumber(s){return s==null?"—":Number(s).toFixed(1)}}},ce={class:"impact-snapshot"},ue={class:"row text-center"},me={class:"col-md-4 mb-3 mb-md-0"},pe={class:"display-6 mb-0"},he={class:"col-md-4 mb-3 mb-md-0"},ve={class:"display-6 mb-0"},be={class:"col-md-4"},_e={class:"display-6 mb-0"};function fe(s,t,i,v,u,o){return l(),r("div",ce,[e("div",ue,[e("div",me,[t[0]||(t[0]=e("p",{class:"text-uppercase small text-muted mb-1"},"Current Impact",-1)),e("p",pe,d(o.formatNumber(i.positive)),1)]),e("div",he,[t[1]||(t[1]=e("p",{class:"text-uppercase small text-muted mb-1"},"Importance in Ideal Role",-1)),e("p",ve,d(o.formatNumber(i.importance)),1)]),e("div",be,[t[2]||(t[2]=e("p",{class:"text-uppercase small text-muted mb-1"},"Desire Gap",-1)),e("p",_e,d(o.formatNumber(i.desire)),1)])])])}const ye=k(de,[["render",fe]]),ge={name:"IndicatorList",props:{indicators:{type:Array,default:()=>[]}},methods:{formatNumber(s){return s==null?"—":Number(s).toFixed(1)},currentWidth(s){return s.current===null||s.current===void 0?"0%":`${Math.max(0,Math.min(s.current/10*100,100))}%`},gapBadge(s){return s==null?"bg-secondary":s>=0?"bg-danger":"bg-success"}}},xe={class:"d-flex justify-content-between align-items-center mb-1"},we={class:"me-2"},Ne={class:"progress",style:{height:"8px"}},$e={class:"text-muted"},ke={key:0,class:"text-muted mb-0"};function Ce(s,t,i,v,u,o){return l(),r("div",null,[(l(!0),r(x,null,w(i.indicators,n=>(l(),r("div",{key:n.key??n.label,class:"mb-3"},[e("div",xe,[e("strong",we,d(n.label),1),e("span",{class:G(["badge",o.gapBadge(n.gap)])},d(o.formatNumber(n.gap)),3)]),e("div",Ne,[e("div",{class:"progress-bar bg-primary",role:"progressbar",style:B({width:o.currentWidth(n)})},null,4)]),e("small",$e," Current "+d(o.formatNumber(n.current))+" / Ideal "+d(o.formatNumber(n.ideal)),1)]))),128)),i.indicators.length?P("",!0):(l(),r("p",ke,"No indicator data yet."))])}const Ie=k(ge,[["render",Ce]]),Ae={name:"TeamCulturePulse",props:{score:{type:Number,default:null},positive:{type:Number,default:null},negative:{type:Number,default:null},positiveItems:{type:Array,default:()=>[]},negativeItems:{type:Array,default:()=>[]}},computed:{scorePercent(){return this.score===null?0:Math.max(0,Math.min((this.score+9)/18*100,100))},scoreText(){return this.score===null?"No data yet":this.score>=0?"Above waterline":"Needs attention"}},methods:{formatNumber(s){return s==null?"—":Number(s).toFixed(1)}}},Te={class:"team-culture-pulse"},Se={class:"row"},Me={class:"col-md-4 mb-3 mb-md-0"},Pe={class:"display-6 mb-1"},De={class:"col-md-4 mb-3 mb-md-0"},Fe={class:"display-6 mb-1"},Ve={class:"col-md-4"},We={class:"progress",style:{height:"8px"}},qe=["aria-valuenow"],je={class:"text-muted"},Be={class:"row"},Le={class:"col-md-6"},Ge={class:"list-unstyled mb-0"},Re={class:"badge bg-danger"},ze={key:0,class:"text-muted"},Ee={class:"col-md-6"},Ue={class:"list-unstyled mb-0"},Xe={class:"badge bg-success"},Ye={key:0,class:"text-muted"};function Oe(s,t,i,v,u,o){return l(),r("div",Te,[e("div",Se,[e("div",Me,[t[0]||(t[0]=e("h6",{class:"text-muted text-uppercase small"},"Positive Signals",-1)),e("p",Pe,d(o.formatNumber(i.positive)),1),t[1]||(t[1]=e("small",{class:"text-muted"},"Average of trust, clarity, respect statements.",-1))]),e("div",De,[t[2]||(t[2]=e("h6",{class:"text-muted text-uppercase small"},"Areas of Friction",-1)),e("p",Fe,d(o.formatNumber(i.negative)),1),t[3]||(t[3]=e("small",{class:"text-muted"},"Average of conflict, bureaucracy, pressure statements.",-1))]),e("div",Ve,[t[4]||(t[4]=e("h6",{class:"text-muted text-uppercase small"},"Net Culture Score",-1)),e("div",We,[e("div",{class:G(["progress-bar",i.score>=0?"bg-success":"bg-danger"]),role:"progressbar",style:B({width:o.scorePercent+"%"}),"aria-valuenow":i.score,"aria-valuemin":"-9","aria-valuemax":"9"},null,14,qe)]),e("small",je,d(o.scoreText),1)])]),t[7]||(t[7]=e("hr",null,null,-1)),e("div",Be,[e("div",Le,[t[5]||(t[5]=e("h6",{class:"text-muted text-uppercase small mb-2"},"Top Tension Drivers",-1)),e("ul",Ge,[(l(!0),r(x,null,w(i.negativeItems,n=>(l(),r("li",{key:n.qid,class:"d-flex justify-content-between"},[e("span",null,d(n.qid),1),e("span",Re,d(o.formatNumber(n.value)),1)]))),128)),i.negativeItems.length?P("",!0):(l(),r("li",ze,"No responses yet."))])]),e("div",Ee,[t[6]||(t[6]=e("h6",{class:"text-muted text-uppercase small mb-2"},"Positive Reinforcers",-1)),e("ul",Ue,[(l(!0),r(x,null,w(i.positiveItems,n=>(l(),r("li",{key:n.qid,class:"d-flex justify-content-between"},[e("span",null,d(n.qid),1),e("span",Xe,d(o.formatNumber(n.value)),1)]))),128)),i.positiveItems.length?P("",!0):(l(),r("li",Ye,"No responses yet."))])])])])}const He=k(Ae,[["render",Oe]]),Ke={name:"TeamScatter",props:{points:{type:Array,default:()=>[]}},mounted(){this.draw()},watch:{points:{handler(){this.draw()},deep:!0}},methods:{capitalize(s){return s?s.charAt(0).toUpperCase()+s.slice(1):""},formatNumber(s){return s==null?"—":Number(s).toFixed(2)},draw(){const s=this.$refs.canvas;if(!s||!this.points.length)return;const t=s.getContext("2d"),i=s.width,v=s.height;t.clearRect(0,0,i,v);const u=40,o=i-u*2,n=v-u*2,C=0,_=10,I=this.points.map(p=>Number(p.culture)).filter(p=>Number.isFinite(p)),A=I.length?Math.floor(Math.min(...I)):0,f=I.length?Math.ceil(Math.max(...I)):10,y=A===f?A-1:A,m=A===f?f+1:f;t.strokeStyle="#d1d5db",t.lineWidth=1,t.beginPath(),t.moveTo(u,u),t.lineTo(u,v-u),t.lineTo(i-u,v-u),t.stroke(),t.fillStyle="#6b7280",t.font="12px sans-serif",t.fillText("Team Culture Evaluation",u-35,u-10),t.fillText("Weighted Indicator Satisfaction",i/2-60,v-10),this.points.forEach(p=>{const b=Number(p.indicator??C),D=Number(p.culture??y),N=(b-C)/(_-C),F=(D-y)/(m-y),$=u+N*o,S=v-u-F*n,L=8;t.beginPath(),t.fillStyle="#2563eb",t.globalAlpha=.7,t.arc($,S,L,0,Math.PI*2),t.fill(),t.globalAlpha=1,t.fillStyle="#111827",t.font="11px sans-serif",t.fillText(p.label??"n/a",$+10,S-5)})}}},Je={class:"team-scatter"},Qe={key:0,class:"text-muted mb-0"},Ze={key:1},et={ref:"canvas",class:"w-100 mb-3",height:"320"},tt={class:"table table-sm align-middle"},st={class:"text-center"},at={class:"text-center"},lt={class:"text-center"};function rt(s,t,i,v,u,o){return l(),r("div",Je,[i.points.length?(l(),r("div",Ze,[e("canvas",et,null,512),e("table",tt,[t[0]||(t[0]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Group"),e("th",null,"Level"),e("th",{class:"text-center"},"People"),e("th",{class:"text-center"},"Indicator (X)"),e("th",{class:"text-center"},"Culture (Y)")])],-1)),e("tbody",null,[(l(!0),r(x,null,w(i.points,n=>(l(),r("tr",{key:n.label},[e("td",null,d(n.label),1),e("td",null,d(o.capitalize(n.level)),1),e("td",st,d(n.count),1),e("td",at,d(o.formatNumber(n.indicator)),1),e("td",lt,d(o.formatNumber(n.culture)),1)]))),128))])])])):(l(),r("p",Qe,"No team data yet."))])}const nt=k(Ke,[["render",rt]]),ot={name:"TemperatureGauge",props:{score:{type:Number,default:0}},computed:{percent(){return Math.max(0,Math.min(this.score/10*100,100))}},methods:{formatNumber(s){return s==null?"—":Number(s).toFixed(1)}}},it={class:"temperature-gauge text-center"},dt={class:"position-relative d-inline-block",style:{width:"100%","max-width":"200px"}},ct={class:"progress",style:{height:"12px","border-radius":"6px"}},ut=["aria-valuenow"],mt={class:"fw-bold mt-1 fs-5"};function pt(s,t,i,v,u,o){return l(),r("div",it,[t[0]||(t[0]=e("small",{class:"text-muted d-block mb-1"},"Weighted Indicator",-1)),e("div",dt,[e("div",ct,[e("div",{class:"progress-bar bg-gradient-success",role:"progressbar",style:B({width:o.percent+"%"}),"aria-valuenow":i.score,"aria-valuemin":"0","aria-valuemax":"10"},null,12,ut)])]),e("div",mt,d(o.formatNumber(i.score))+"/10",1)])}const ht=k(ot,[["render",pt],["__scopeId","data-v-ffefbc25"]]),vt={class:"analytics-dashboard"},bt={class:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"},_t={class:"d-flex flex-wrap gap-2 align-items-center"},ft=["value"],yt=["disabled"],gt=["value"],xt=["disabled"],wt=["value"],Nt=["disabled"],$t=["value"],kt=["disabled"],Ct={key:0,class:"alert alert-info"},It={key:1,class:"alert alert-warning"},At={key:2,class:"text-center py-5"},Tt={key:3,class:"alert alert-danger"},St={key:4,class:"dashboard-content"},Mt={class:"row mb-4"},Pt={class:"col-md-4"},Dt={class:"card h-100 shadow-sm"},Ft={class:"card-body d-flex align-items-center justify-content-center"},Vt={class:"col-md-8"},Wt={class:"card h-100 shadow-sm"},qt={class:"card-body"},jt={class:"row mb-4"},Bt={class:"col-lg-8"},Lt={class:"card h-100 shadow-sm"},Gt={class:"card-body"},Rt={class:"col-lg-4"},zt={class:"card h-100 shadow-sm"},Et={class:"card-body"},Ut={key:1,class:"text-center text-muted py-4"},Xt={class:"row mb-4"},Yt={class:"col-lg-6"},Ot={class:"card h-100 shadow-sm"},Ht={class:"card-body"},Kt={class:"col-lg-6"},Jt={class:"card h-100 shadow-sm"},Qt={class:"card-body"},Zt={key:1,class:"text-center text-muted py-4"},es={__name:"AnalyticsDashboard",props:{user:{type:Object,required:!0},initialCompanyId:{type:[Number,String],default:null},companies:{type:Array,default:()=>[]}},setup(s){const t=s,{getDashboardData:i}=Z(),v=h=>{const a=Number(h);return Number.isFinite(a)&&a>0?a:null},u=T(()=>{var h;return v(t.initialCompanyId)??v((h=t.user)==null?void 0:h.company_id)}),o=V(u.value?String(u.value):""),n=T(()=>{var h,a;return Number(((h=t.user)==null?void 0:h.is_admin)??0)===1||Number(((a=t.user)==null?void 0:a.role)??0)===0}),C=T(()=>v(o.value)),_=T(()=>C.value!==null),I=T(()=>n.value&&!_.value),A=T(()=>!n.value&&!_.value),f=V(!1),y=V(null),m=V({}),p=U({departments:[],teamleads:[],waves:[],exist_departments:[]}),b=U({department:"",team:"",wave:""}),D=()=>{p.departments=[],p.teamleads=[],p.waves=[],p.exist_departments=[]};let N=0;const F=()=>{b.department="",b.team="",b.wave=""},$=async()=>{var a,c,M,R,z,E;if(!_.value){f.value=!1,y.value=null,m.value={},D();return}f.value=!0,y.value=null;const h=++N;try{const g=await i({company_id:C.value,department:b.department,team:b.team,wave:b.wave});if(h!==N)return;m.value=g.data||{},p.departments=((a=g.filters)==null?void 0:a.departments)||[],p.teamleads=((c=g.filters)==null?void 0:c.teamleads)||[],p.waves=((M=g.filters)==null?void 0:M.waves)||[],p.exist_departments=((R=g.filters)==null?void 0:R.exist_departments)||[]}catch(g){if(h!==N)return;console.error("Error fetching analytics:",g),y.value=((E=(z=g==null?void 0:g.response)==null?void 0:z.data)==null?void 0:E.message)||"Failed to load dashboard data. Please try again."}finally{if(h!==N)return;f.value=!1}},S=K.debounce($,400),L=h=>h?h.filter(a=>a.polarity==="positive").slice(0,3):[],O=h=>h?h.filter(a=>a.polarity==="negative").slice(0,3):[];return X(b,()=>{_.value&&S()},{deep:!0}),X(o,()=>{N+=1,S.cancel(),F(),m.value={},D(),_.value?$():(f.value=!1,y.value=null)}),J(()=>{_.value&&$()}),(h,a)=>(l(),r("div",vt,[e("div",bt,[a[8]||(a[8]=e("h1",{class:"h3 mb-0 text-gray-800"},"Dashboard Analytics",-1)),e("div",_t,[n.value?W((l(),r("select",{key:0,"onUpdate:modelValue":a[0]||(a[0]=c=>o.value=c),class:"form-select form-select-sm",style:{width:"240px"}},[a[4]||(a[4]=e("option",{value:""},"Select Company",-1)),(l(!0),r(x,null,w(s.companies,c=>(l(),r("option",{key:c.id,value:String(c.id)},d(c.title),9,ft))),128))],512)),[[q,o.value]]):P("",!0),W(e("select",{"onUpdate:modelValue":a[1]||(a[1]=c=>b.department=c),class:"form-select form-select-sm",style:{width:"200px"},disabled:!_.value},[a[5]||(a[5]=e("option",{value:""},"All Departments",-1)),(l(!0),r(x,null,w(p.departments,c=>(l(),r("option",{key:c.department,value:c.department},d(c.department),9,gt))),128))],8,yt),[[q,b.department]]),W(e("select",{"onUpdate:modelValue":a[2]||(a[2]=c=>b.team=c),class:"form-select form-select-sm",style:{width:"200px"},disabled:!_.value},[a[6]||(a[6]=e("option",{value:""},"All Teams",-1)),(l(!0),r(x,null,w(p.teamleads,c=>(l(),r("option",{key:c.name,value:c.name},d(c.name),9,wt))),128))],8,xt),[[q,b.team]]),W(e("select",{"onUpdate:modelValue":a[3]||(a[3]=c=>b.wave=c),class:"form-select form-select-sm",style:{width:"200px"},disabled:!_.value},[a[7]||(a[7]=e("option",{value:""},"Latest Wave",-1)),(l(!0),r(x,null,w(p.waves,(c,M)=>(l(),r("option",{key:M,value:M},d(c),9,$t))),128))],8,Nt),[[q,b.wave]]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:F,disabled:f.value||!_.value}," Reset ",8,kt)])]),I.value?(l(),r("div",Ct," Select a company to load analytics. ")):A.value?(l(),r("div",It," No company context found for your account. Contact an administrator to assign a company. ")):f.value?(l(),r("div",At,[...a[9]||(a[9]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2 text-muted"},"Loading analytics data...",-1)])])):y.value?(l(),r("div",Tt,[Q(d(y.value)+" ",1),e("button",{class:"btn btn-sm btn-link",onClick:$},"Try Again")])):(l(),r("div",St,[e("div",Mt,[e("div",Pt,[e("div",Dt,[a[10]||(a[10]=e("div",{class:"card-header bg-white py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Temperature Index")],-1)),e("div",Ft,[j(ht,{score:m.value.weighted_indicator},null,8,["score"])])])]),e("div",Vt,[e("div",Wt,[a[11]||(a[11]=e("div",{class:"card-header bg-white py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Key Indicators")],-1)),e("div",qt,[j(Ie,{indicators:m.value.indicators||[]},null,8,["indicators"])])])])]),e("div",jt,[e("div",Bt,[e("div",Lt,[a[12]||(a[12]=e("div",{class:"card-header bg-white py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Gap Analysis")],-1)),e("div",Gt,[j(ie,{items:m.value.gap_chart||[]},null,8,["items"])])])]),e("div",Rt,[e("div",zt,[a[13]||(a[13]=e("div",{class:"card-header bg-white py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Team Culture Pulse")],-1)),e("div",Et,[m.value.team_culture?(l(),Y(He,{key:0,score:m.value.team_culture.score,positive:m.value.team_culture.positive,negative:m.value.team_culture.negative,"positive-items":L(m.value.team_culture.items),"negative-items":O(m.value.team_culture.items)},null,8,["score","positive","negative","positive-items","negative-items"])):(l(),r("div",Ut," No culture data available "))])])])]),e("div",Xt,[e("div",Yt,[e("div",Ot,[a[14]||(a[14]=e("div",{class:"card-header bg-white py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Team Scatter Plot")],-1)),e("div",Ht,[j(nt,{points:m.value.team_scatter||[]},null,8,["points"])])])]),e("div",Kt,[e("div",Jt,[a[15]||(a[15]=e("div",{class:"card-header bg-white py-3"},[e("h6",{class:"m-0 font-weight-bold text-primary"},"Impact Snapshot")],-1)),e("div",Qt,[m.value.impact?(l(),Y(ye,{key:0,positive:m.value.impact.positive,importance:m.value.impact.importance,desire:m.value.impact.desire},null,8,["positive","importance","desire"])):(l(),r("div",Zt," No impact data available "))])])])])]))]))}},as=k(es,[["__scopeId","data-v-a0b8cb48"]]);export{as as default};
