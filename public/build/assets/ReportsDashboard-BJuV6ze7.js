import{b as v,e as a,f as n,q as S,u as $,r as f,w as j,o as G,g as t,B as F,j as D,C as q,F as J,y as K,l as Q,m as A,k as w}from"./vendor-vue-B_7dnjM8.js";import{a as P}from"./vendor-axios-B9ygI19o.js";import{C as W,a as E,L as V,B as X,p as L,b as O,c as M,d as Y,P as Z,e as ee,i as te,f as se}from"./vendor-charts-D4532vWU.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ne(){return{getTrends:async(p="engagement",l=null)=>{const i={metric:p};l&&(i.company_id=l);const{data:d}=await P.get("/reports/trends",{params:i});return d},getComparison:async(p="department",l=null,i=null)=>{const d={dimension:p};l&&(d.wave_id=l),i&&(d.company_id=i);const{data:h}=await P.get("/reports/comparison",{params:d});return h}}}const oe={class:"chart-container",style:{position:"relative",height:"300px",width:"100%"}},re={__name:"ComparisonChart",props:{data:{type:Object,required:!0}},setup(b){W.register(E,V,X,L,O,M);const c=b,p=v(()=>c.data),l={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{family:"'Inter', sans-serif",size:12},usePointStyle:!0,boxWidth:8}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#1f2937",bodyColor:"#4b5563",borderColor:"#e5e7eb",borderWidth:1,padding:12,boxPadding:4,usePointStyle:!0,titleFont:{family:"'Inter', sans-serif",size:13,weight:"600"},bodyFont:{family:"'Inter', sans-serif",size:12}}},scales:{y:{min:0,max:10,grid:{color:"#f3f4f6",drawBorder:!1},ticks:{font:{family:"'Inter', sans-serif",size:11},color:"#9ca3af",padding:10},border:{display:!1}},x:{grid:{display:!1,drawBorder:!1},ticks:{font:{family:"'Inter', sans-serif",size:11},color:"#9ca3af"},border:{display:!1}}},elements:{bar:{borderRadius:4,borderSkipped:!1}}};return(i,d)=>(n(),a("div",oe,[S($(Y),{data:p.value,options:l},null,8,["data"])]))}},le={class:"chart-container",style:{position:"relative",height:"300px",width:"100%"}},ie={__name:"TrendChart",props:{data:{type:Object,required:!0}},setup(b){W.register(E,V,Z,ee,L,O,M,te);const c=b,p=v(()=>c.data),l={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{family:"'Inter', sans-serif",size:12},usePointStyle:!0,boxWidth:8}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#1f2937",bodyColor:"#4b5563",borderColor:"#e5e7eb",borderWidth:1,padding:12,boxPadding:4,usePointStyle:!0,titleFont:{family:"'Inter', sans-serif",size:13,weight:"600"},bodyFont:{family:"'Inter', sans-serif",size:12}}},scales:{y:{min:0,max:10,grid:{color:"#f3f4f6",drawBorder:!1},ticks:{font:{family:"'Inter', sans-serif",size:11},color:"#9ca3af",padding:10},border:{display:!1}},x:{grid:{display:!1,drawBorder:!1},ticks:{font:{family:"'Inter', sans-serif",size:11},color:"#9ca3af"},border:{display:!1}}},elements:{line:{tension:.4,borderWidth:3},point:{radius:4,hoverRadius:6,backgroundColor:"#fff",borderWidth:2}}};return(i,d)=>(n(),a("div",le,[S($(se),{data:p.value,options:l},null,8,["data"])]))}},de={class:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"},ue={class:"d-flex gap-2 align-items-center"},ce=["value"],pe={key:0,class:"alert alert-info"},me={key:1,class:"alert alert-warning"},fe={key:2,class:"alert alert-danger"},ve={key:3,class:"row g-4"},be={class:"col-md-3"},ge={class:"card border-0 shadow-sm h-100"},ye={class:"card-body p-3"},he={class:"d-flex flex-column gap-2"},xe={class:"col-md-9"},we={key:0,class:"card border-0 shadow-sm"},Ce={class:"card-header bg-white border-0 pt-4 px-4 d-flex justify-content-between align-items-center"},_e={class:"bg-light p-1 rounded-pill d-flex align-items-center border"},ke={class:"card-body p-4"},Ie={key:0,class:"text-center py-5"},Se={key:1,class:"chart-container",style:{position:"relative",height:"400px"}},Te={key:2,class:"text-center py-5 text-muted"},Be={key:1,class:"card border-0 shadow-sm"},Ne={class:"card-header bg-white border-0 pt-4 px-4 d-flex justify-content-between align-items-center"},ze={class:"d-flex gap-2"},De={class:"card-body p-4"},Re={key:0,class:"text-center py-5"},je={key:1,class:"chart-container",style:{position:"relative",height:"400px"}},Fe={key:2,class:"text-center py-5 text-muted"},qe={__name:"ReportsDashboard",props:{user:{type:Object,required:!0},initialCompanyId:{type:[Number,String],default:null},companies:{type:Array,default:()=>[]}},setup(b){const c=b,{getTrends:p,getComparison:l}=ne(),i=s=>{const e=Number(s);return Number.isFinite(e)&&e>0?e:null},d=v(()=>{var s;return i(c.initialCompanyId)??i((s=c.user)==null?void 0:s.company_id)}),h=f(d.value?String(d.value):""),T=v(()=>{var s,e;return Number(((s=c.user)==null?void 0:s.is_admin)??0)===1||Number(((e=c.user)==null?void 0:e.role)??0)===0}),B=v(()=>i(h.value)),g=v(()=>B.value!==null),H=v(()=>T.value&&!g.value),U=v(()=>!T.value&&!g.value),u=f("trends"),x=f(!1),y=f(null),C=f("engagement"),_=f(null),N=f("department"),k=f(null);let m=0;const I=async()=>{var e,o;if(!g.value)return;x.value=!0,y.value=null;const s=++m;try{const r=await p(C.value,B.value);if(s!==m)return;_.value=r}catch(r){if(s!==m)return;console.error(r),y.value=((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to load trends."}finally{if(s!==m)return;x.value=!1}},z=async()=>{var e,o;if(!g.value)return;x.value=!0,y.value=null;const s=++m;try{const r=await l(N.value,null,B.value);if(s!==m)return;k.value=r}catch(r){if(s!==m)return;console.error(r),y.value=((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to load comparison report."}finally{if(s!==m)return;x.value=!1}},R=async()=>{if(u.value==="comparison"){await z();return}await I()};return j(u,s=>{g.value&&(s==="trends"&&!_.value&&I(),s==="comparison"&&!k.value&&z())}),j(h,()=>{m+=1,_.value=null,k.value=null,y.value=null,g.value&&R()}),G(()=>{g.value&&I()}),(s,e)=>(n(),a("div",null,[t("div",de,[e[7]||(e[7]=t("h1",{class:"h3 mb-0 text-gray-800"},"Reports",-1)),t("div",ue,[T.value?F((n(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),class:"form-select form-select-sm",style:{width:"260px"}},[e[6]||(e[6]=t("option",{value:""},"Select Company",-1)),(n(!0),a(J,null,K(b.companies,o=>(n(),a("option",{key:o.id,value:String(o.id)},A(o.title),9,ce))),128))],512)),[[q,h.value]]):D("",!0)])]),H.value?(n(),a("div",pe," Select a company to view reports. ")):U.value?(n(),a("div",me," No company context found for your account. Contact an administrator to assign a company. ")):y.value?(n(),a("div",fe,[Q(A(y.value)+" ",1),t("button",{class:"btn btn-sm btn-link",onClick:R},"Try Again")])):(n(),a("div",ve,[t("div",be,[t("div",ge,[t("div",ye,[e[12]||(e[12]=t("h6",{class:"text-secondary text-uppercase small fw-bold mb-3 px-3"},"Reports",-1)),t("div",he,[t("button",{class:w(["btn text-start p-3 rounded-3 d-flex align-items-center transition-all",u.value==="trends"?"btn-primary shadow-sm":"btn-light bg-white hover-bg text-dark border-0"]),onClick:e[1]||(e[1]=o=>u.value="trends")},[t("div",{class:w(["rounded-circle p-2 me-3 d-flex align-items-center justify-content-center",u.value==="trends"?"bg-white bg-opacity-25":"bg-light"])},[...e[8]||(e[8]=[t("i",{class:"bi bi-graph-up-arrow fs-5"},null,-1)])],2),e[9]||(e[9]=t("div",null,[t("div",{class:"fw-bold"},"Trends"),t("div",{class:"small opacity-75"},"Historical performance")],-1))],2),t("button",{class:w(["btn text-start p-3 rounded-3 d-flex align-items-center transition-all",u.value==="comparison"?"btn-primary shadow-sm":"btn-light bg-white hover-bg text-dark border-0"]),onClick:e[2]||(e[2]=o=>u.value="comparison")},[t("div",{class:w(["rounded-circle p-2 me-3 d-flex align-items-center justify-content-center",u.value==="comparison"?"bg-white bg-opacity-25":"bg-light"])},[...e[10]||(e[10]=[t("i",{class:"bi bi-bar-chart-fill fs-5"},null,-1)])],2),e[11]||(e[11]=t("div",null,[t("div",{class:"fw-bold"},"Comparisons"),t("div",{class:"small opacity-75"},"Team vs Team analysis")],-1))],2)])])])]),t("div",xe,[u.value==="trends"?(n(),a("div",we,[t("div",Ce,[e[13]||(e[13]=t("div",null,[t("h5",{class:"mb-1 fw-bold"},"Historical Trends"),t("p",{class:"text-muted small mb-0"},"Track engagement and culture scores over time.")],-1)),t("div",_e,[t("button",{class:w(["btn btn-sm rounded-pill px-3 fw-semibold transition-all",C.value==="engagement"?"btn-white shadow-sm text-primary":"text-muted"]),onClick:e[3]||(e[3]=o=>{C.value="engagement",I()})}," Engagement ",2),t("button",{class:w(["btn btn-sm rounded-pill px-3 fw-semibold transition-all",C.value==="culture"?"btn-white shadow-sm text-primary":"text-muted"]),onClick:e[4]||(e[4]=o=>{C.value="culture",I()})}," Culture ",2)])]),t("div",ke,[x.value?(n(),a("div",Ie,[...e[14]||(e[14]=[t("div",{class:"spinner-border text-primary",role:"status"},null,-1)])])):_.value?(n(),a("div",Se,[S(ie,{data:_.value},null,8,["data"])])):(n(),a("div",Te,[...e[15]||(e[15]=[t("div",{class:"bg-light rounded-circle p-4 mb-3 d-inline-block"},[t("i",{class:"bi bi-graph-up text-secondary display-4"})],-1),t("p",null,"No data available for the selected period.",-1)])]))])])):D("",!0),u.value==="comparison"?(n(),a("div",Be,[t("div",Ne,[e[17]||(e[17]=t("div",null,[t("h5",{class:"mb-1 fw-bold"},"Comparative Analysis"),t("p",{class:"text-muted small mb-0"},"Compare performance across different groups.")],-1)),t("div",ze,[F(t("select",{class:"form-select form-select-sm bg-light border-0 fw-semibold","onUpdate:modelValue":e[5]||(e[5]=o=>N.value=o),onChange:z},[...e[16]||(e[16]=[t("option",{value:"department"},"By Department",-1),t("option",{value:"team"},"By Team (Supervisor)",-1)])],544),[[q,N.value]])])]),t("div",De,[x.value?(n(),a("div",Re,[...e[18]||(e[18]=[t("div",{class:"spinner-border text-primary",role:"status"},null,-1)])])):k.value?(n(),a("div",je,[S(re,{data:k.value},null,8,["data"])])):(n(),a("div",Fe,[...e[19]||(e[19]=[t("div",{class:"bg-light rounded-circle p-4 mb-3 d-inline-block"},[t("i",{class:"bi bi-bar-chart text-secondary display-4"})],-1),t("p",null,"No comparison data available.",-1)])]))])])):D("",!0)])]))]))}},Ee=ae(qe,[["__scopeId","data-v-be09d255"]]);export{Ee as default};
