import{r as $,p as D,m as L,a as n,o as a,b as e,F as I,h as J,q as b,y,e as h,c as F,t as w,d as N,v as j,z as A,f as M,n as U,i as C,w as E}from"./app-BeGgamdR.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"logic-editor"},z={key:0,class:"text-center p-3 bg-light rounded mb-3"},P={key:1,class:"list-group mb-3"},Q={class:"d-flex align-items-center gap-2 mb-2"},G=["onUpdate:modelValue"],H={class:"flex-grow-1"},K=["onUpdate:modelValue"],W=["onClick"],X={__name:"LogicEditor",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(x,{emit:V}){const u=x,S=V,o=$([]),r=t=>!t||!t.when?[]:t.when.map(l=>({qid:l.qid,value:l.equals_any?l.equals_any[0]:""}));D(()=>{o.value=r(u.modelValue)}),L(()=>u.modelValue,t=>{const l=JSON.stringify(p(o.value)),v=JSON.stringify(t);l!==v&&(o.value=r(t))});const p=t=>t.length===0?null:{when:t.map(l=>({qid:l.qid,equals_any:[l.value]}))},_=()=>{o.value.push({qid:"",value:""}),d()},q=t=>{o.value.splice(t,1),d()},d=()=>{S("update:modelValue",p(o.value))};return L(o,()=>{d()},{deep:!0}),(t,l)=>(a(),n("div",R,[o.value.length===0?(a(),n("div",z,[...l[0]||(l[0]=[e("small",{class:"text-muted"},"No display logic defined. This question will always be shown.",-1)])])):(a(),n("div",P,[(a(!0),n(I,null,J(o.value,(v,k)=>(a(),n("div",{key:k,class:"list-group-item bg-light"},[e("div",Q,[l[2]||(l[2]=e("span",{class:"badge bg-secondary"},"IF",-1)),b(e("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":i=>v.qid=i,placeholder:"Question ID (e.g. q1)",style:{width:"120px"}},null,8,G),[[y,v.qid]]),l[3]||(l[3]=e("select",{class:"form-select form-select-sm",style:{width:"100px"},disabled:""},[e("option",null,"Equals")],-1)),e("div",H,[b(e("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":i=>v.value=i,placeholder:"Value to match"},null,8,K),[[y,v.value]])]),e("button",{class:"btn btn-outline-danger btn-sm",onClick:i=>q(k)},[...l[1]||(l[1]=[e("i",{class:"bi bi-trash"},null,-1)])],8,W)])]))),128))])),e("button",{class:"btn btn-sm btn-outline-primary w-100",onClick:_},[...l[4]||(l[4]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),h(" Add Logic Rule ",-1)])])]))}},Y={class:"card border-0 shadow-sm"},Z={class:"card-header bg-white border-0 pt-4 px-4 d-flex justify-content-between align-items-center"},ee={class:"badge bg-light text-secondary border rounded-pill fw-normal font-monospace"},te={class:"badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill px-3"},se={class:"card-body p-4"},le={class:"mb-4"},oe={class:"row mb-4"},ie={class:"col-md-6"},ne={class:"col-md-6"},ae={key:0,class:"mb-4 p-4 rounded bg-light border-0"},re={class:"row g-3"},de={class:"col-4"},ue={class:"col-4"},ce={class:"col-4"},me={class:"col-6"},be={class:"col-6"},pe={key:1,class:"mb-4 p-4 rounded bg-light border-0"},ve={class:"input-group-text bg-white border-end-0 text-muted small"},ge=["onUpdate:modelValue"],fe=["onClick"],ye={key:0,class:"text-center text-muted small fst-italic py-3"},xe={class:"mb-4"},he={class:"collapse",id:"logicEditor"},_e={class:"card card-body bg-light border-0 pt-0"},we={class:"d-flex justify-content-end gap-2 pt-4 border-top"},ke=["disabled"],$e={key:0,class:"spinner-border spinner-border-sm me-2"},Se={__name:"QuestionEditor",props:{item:{type:Object,required:!0},saving:{type:Boolean,default:!1}},emits:["save","cancel"],setup(x,{emit:V}){const u=x,S=V,o=$(JSON.parse(JSON.stringify(u.item))),r=$(u.item.options?JSON.parse(JSON.stringify(u.item.options)):[]);o.value.scale_config||(o.value.scale_config={min:1,max:5,step:1}),F({get:()=>JSON.stringify(o.value.display_logic||{},null,2),set:d=>{try{o.value.display_logic=JSON.parse(d)}catch{}}});const p=()=>{const d=r.value.length+1;r.value.push({value:d,label:`Option ${d}`})},_=d=>{r.value.splice(d,1)},q=()=>{const d={...o.value,options:r.value};S("save",d)};return L(()=>u.item,d=>{o.value=JSON.parse(JSON.stringify(d)),r.value=d.options?JSON.parse(JSON.stringify(d.options)):[],o.value.scale_config||(o.value.scale_config={min:1,max:5,step:1})}),(d,t)=>(a(),n("div",Y,[e("div",Z,[e("div",null,[t[10]||(t[10]=e("h5",{class:"mb-1 fw-bold"},"Edit Question",-1)),e("span",ee,w(x.item.qid),1)]),e("span",te,w(x.item.type),1)]),e("div",se,[e("div",le,[t[11]||(t[11]=e("label",{class:"form-label text-secondary small fw-bold text-uppercase"},"Question Text",-1)),b(e("input",{type:"text",class:"form-control form-control-lg","onUpdate:modelValue":t[0]||(t[0]=l=>o.value.question=l),placeholder:"Enter your question here..."},null,512),[[y,o.value.question]])]),e("div",oe,[e("div",ie,[t[13]||(t[13]=e("label",{class:"form-label text-secondary small fw-bold text-uppercase"},"Type",-1)),b(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=l=>o.value.type=l)},[...t[12]||(t[12]=[A('<option value="slider">Slider (Scale)</option><option value="text">Text Input</option><option value="text_long">Long Text</option><option value="number_integer">Number (Integer)</option><option value="single_select">Single Select</option><option value="single_select_text">Single Select + Other</option><option value="multi_select">Multi Select</option>',7)])],512),[[j,o.value.type]])]),e("div",ne,[t[14]||(t[14]=e("label",{class:"form-label text-secondary small fw-bold text-uppercase"},"QID",-1)),b(e("input",{type:"text",class:"form-control bg-light","onUpdate:modelValue":t[2]||(t[2]=l=>o.value.qid=l),disabled:""},null,512),[[y,o.value.qid]])])]),o.value.type==="slider"?(a(),n("div",ae,[t[20]||(t[20]=e("h6",{class:"mb-3 fw-bold text-secondary"},"Scale Configuration",-1)),e("div",re,[e("div",de,[t[15]||(t[15]=e("label",{class:"small text-muted fw-semibold"},"Min",-1)),b(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":t[3]||(t[3]=l=>o.value.scale_config.min=l)},null,512),[[y,o.value.scale_config.min,void 0,{number:!0}]])]),e("div",ue,[t[16]||(t[16]=e("label",{class:"small text-muted fw-semibold"},"Max",-1)),b(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":t[4]||(t[4]=l=>o.value.scale_config.max=l)},null,512),[[y,o.value.scale_config.max,void 0,{number:!0}]])]),e("div",ce,[t[17]||(t[17]=e("label",{class:"small text-muted fw-semibold"},"Step",-1)),b(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":t[5]||(t[5]=l=>o.value.scale_config.step=l)},null,512),[[y,o.value.scale_config.step,void 0,{number:!0}]])]),e("div",me,[t[18]||(t[18]=e("label",{class:"small text-muted fw-semibold"},"Left Label",-1)),b(e("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":t[6]||(t[6]=l=>o.value.scale_config.left_label=l),placeholder:"e.g. Disagree"},null,512),[[y,o.value.scale_config.left_label]])]),e("div",be,[t[19]||(t[19]=e("label",{class:"small text-muted fw-semibold"},"Right Label",-1)),b(e("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":t[7]||(t[7]=l=>o.value.scale_config.right_label=l),placeholder:"e.g. Agree"},null,512),[[y,o.value.scale_config.right_label]])])])])):N("",!0),["single_select","multi_select","single_select_text"].includes(o.value.type)?(a(),n("div",pe,[e("h6",{class:"mb-3 d-flex justify-content-between align-items-center fw-bold text-secondary"},[t[22]||(t[22]=h(" Options ",-1)),e("button",{class:"btn btn-sm btn-white border shadow-sm text-primary",onClick:p},[...t[21]||(t[21]=[e("i",{class:"bi bi-plus-lg me-1"},null,-1),h(" Add Option ",-1)])])]),(a(!0),n(I,null,J(r.value,(l,v)=>(a(),n("div",{key:v,class:"input-group mb-2 shadow-sm"},[e("span",ve,w(l.value),1),b(e("input",{type:"text",class:"form-control border-start-0","onUpdate:modelValue":k=>l.label=k,placeholder:"Label"},null,8,ge),[[y,l.label]]),e("button",{class:"btn btn-white border text-danger",onClick:k=>_(v)},[...t[23]||(t[23]=[e("i",{class:"bi bi-trash"},null,-1)])],8,fe)]))),128)),r.value.length===0?(a(),n("div",ye,' No options defined. Click "Add Option" to start. ')):N("",!0)])):N("",!0),e("div",xe,[t[25]||(t[25]=e("button",{class:"btn btn-light w-100 d-flex justify-content-between align-items-center p-3 border-0 bg-light text-secondary",type:"button","data-bs-toggle":"collapse","data-bs-target":"#logicEditor"},[e("span",null,[e("i",{class:"bi bi-diagram-3 me-2"}),h(" Display Logic")]),e("i",{class:"bi bi-chevron-down"})],-1)),e("div",he,[e("div",_e,[t[24]||(t[24]=e("hr",{class:"mt-0 mb-3 opacity-25"},null,-1)),M(X,{modelValue:o.value.display_logic,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.display_logic=l)},null,8,["modelValue"])])])]),e("div",we,[e("button",{class:"btn btn-light px-4",onClick:t[9]||(t[9]=l=>d.$emit("cancel"))},"Cancel"),e("button",{class:"btn btn-primary px-4 shadow-sm",onClick:q,disabled:x.saving},[x.saving?(a(),n("span",$e)):N("",!0),h(" "+w(x.saving?"Saving...":"Save Changes"),1)],8,ke)])])]))}},Ve={class:"container-fluid py-4"},Ce={class:"row g-4"},qe={class:"col-md-3"},Ne={class:"card border-0 shadow-sm h-100"},Oe={class:"card-body p-2 overflow-auto",style:{"max-height":"calc(100vh - 200px)"}},Ue={key:0,class:"text-center py-3"},Ie={key:1,class:"list-group list-group-flush"},Je=["onClick"],Ee={class:"fw-semibold"},Le={class:"ps-2 border-start ms-3 border-2"},Te=["onClick"],De={class:"badge bg-light text-secondary border me-2 rounded-pill",style:{width:"35px"}},Me={class:"text-truncate flex-grow-1"},Fe={key:0,class:"btn-group btn-group-sm ms-2 opacity-0 group-item-actions-show"},je=["onClick","disabled"],Ae=["onClick","disabled"],Be={class:"col-md-6"},Re={key:0},ze={key:1,class:"card border-0 shadow-sm"},Pe={class:"card-body p-4"},Qe={class:"mb-3"},Ge={key:2,class:"text-center py-5 text-muted d-flex flex-column align-items-center justify-content-center h-100",style:{"min-height":"400px"}},He={class:"col-md-3"},Ke={class:"card border-0 shadow-sm"},We={class:"card-body p-4"},Xe={class:"d-flex align-items-center mb-4"},Ye={class:"text-muted font-monospace"},Ze={key:0},et={key:1},tt={__name:"SurveyBuilder",props:{initialVersionId:{type:Number,required:!0},surveyId:{type:Number,required:!0}},setup(x){const V=x,u=$({pages:[]}),S=$(!1),o=$(!1),r=$(null),p=$(null),_=async()=>{S.value=!0;try{const i=u.value.id||V.initialVersionId,{data:s}=await C.get(`/admin/builder/structure/${i}`);u.value=s}catch(i){console.error(i),alert("Failed to load structure")}finally{S.value=!1}},q=i=>{r.value=JSON.parse(JSON.stringify(i)),p.value="item"},d=i=>{r.value=i,p.value="page"},t=async i=>{var s,c;o.value=!0;try{await C.post(`/admin/builder/item/${i.id}`,i),await _(),r.value=null}catch(m){console.error(m),alert(((c=(s=m.response)==null?void 0:s.data)==null?void 0:c.message)||"Failed to save")}finally{o.value=!1}},l=async()=>{if(confirm("Create a new editable draft from this version?"))try{const{data:i}=await C.post(`/admin/builder/draft/${V.surveyId}`),{data:s}=await C.get(`/admin/builder/structure/${i.draft_id}`);u.value=s,r.value=null}catch(i){console.error(i),alert("Failed to create draft")}},v=async()=>{if(confirm("Are you sure? This will make this version LIVE and collect real data."))try{await C.post(`/admin/builder/publish/${u.value.id}`),_()}catch(i){console.error(i),alert("Failed to publish")}},k=async(i,s,c)=>{const m=[...i.items],g=s+c;if(!(g<0||g>=m.length)){[m[s],m[g]]=[m[g],m[s]],m.forEach((f,O)=>f.sort_order=O),i.items=m;try{await C.post("/admin/builder/reorder",{items:m.map(f=>({id:f.id,sort_order:f.sort_order}))})}catch(f){console.error(f),alert("Failed to reorder"),_()}}};return D(()=>{_()}),(i,s)=>(a(),n("div",Ve,[e("div",Ce,[e("div",qe,[e("div",Ne,[e("div",{class:"card-header bg-white border-0 pt-3 px-3 d-flex justify-content-between align-items-center"},[s[3]||(s[3]=e("h6",{class:"mb-0 fw-bold text-secondary text-uppercase small ls-1"},"Structure",-1)),e("button",{class:"btn btn-sm btn-light text-primary rounded-circle",onClick:_,title:"Refresh"},[...s[2]||(s[2]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1)])])]),e("div",Oe,[S.value?(a(),n("div",Ue,[...s[4]||(s[4]=[e("div",{class:"spinner-border spinner-border-sm text-primary"},null,-1)])])):(a(),n("div",Ie,[(a(!0),n(I,null,J(u.value.pages,c=>{var m;return a(),n("div",{key:c.id,class:"mb-3"},[e("div",{class:U(["d-flex align-items-center p-2 rounded mb-1 transition-all",((m=r.value)==null?void 0:m.id)===c.id&&p.value==="page"?"bg-primary text-white shadow-sm":"bg-light text-dark hover-lift"]),onClick:g=>d(c),style:{cursor:"pointer"}},[s[5]||(s[5]=e("i",{class:"bi bi-file-earmark-text me-2 opacity-75"},null,-1)),e("span",Ee,w(c.title),1)],10,Je),e("div",Le,[(a(!0),n(I,null,J(c.items,(g,f)=>{var O;return a(),n("div",{key:g.id,class:U(["d-flex align-items-center p-2 mb-1 rounded transition-all group-item-actions",((O=r.value)==null?void 0:O.id)===g.id&&p.value==="item"?"bg-white border-start border-4 border-primary shadow-sm":"text-muted hover-bg"]),onClick:E(T=>q(g),["stop"]),style:{cursor:"pointer","font-size":"0.9rem"}},[e("span",De,w(g.qid),1),e("span",Me,w(g.question),1),u.value.is_active?N("",!0):(a(),n("div",Fe,[e("button",{class:"btn btn-xs btn-light py-0 px-1",onClick:E(T=>k(c,f,-1),["stop"]),disabled:f===0,title:"Move Up"},[...s[6]||(s[6]=[e("i",{class:"bi bi-chevron-up",style:{"font-size":"0.7em"}},null,-1)])],8,je),e("button",{class:"btn btn-xs btn-light py-0 px-1",onClick:E(T=>k(c,f,1),["stop"]),disabled:f===c.items.length-1,title:"Move Down"},[...s[7]||(s[7]=[e("i",{class:"bi bi-chevron-down",style:{"font-size":"0.7em"}},null,-1)])],8,Ae)]))],10,Te)}),128))])])}),128))]))])])]),e("div",Be,[r.value&&p.value==="item"?(a(),n("div",Re,[M(Se,{item:r.value,saving:o.value,onSave:t,onCancel:s[0]||(s[0]=c=>r.value=null)},null,8,["item","saving"])])):r.value&&p.value==="page"?(a(),n("div",ze,[s[10]||(s[10]=e("div",{class:"card-header bg-white border-0 pt-4 px-4"},[e("h5",{class:"mb-0 fw-bold"},"Edit Page")],-1)),e("div",Pe,[e("div",Qe,[s[8]||(s[8]=e("label",{class:"form-label text-secondary small fw-bold text-uppercase"},"Page Title",-1)),b(e("input",{type:"text",class:"form-control form-control-lg","onUpdate:modelValue":s[1]||(s[1]=c=>r.value.title=c),disabled:""},null,512),[[y,r.value.title]])]),s[9]||(s[9]=e("div",{class:"alert alert-light border-0 bg-light text-secondary d-flex align-items-center"},[e("i",{class:"bi bi-info-circle me-2 fs-5"}),h(" Page editing and reordering coming soon. ")],-1))])])):(a(),n("div",Ge,[...s[11]||(s[11]=[e("div",{class:"bg-light rounded-circle p-4 mb-3"},[e("i",{class:"bi bi-cursor text-secondary display-4"})],-1),e("h5",{class:"fw-bold text-dark"},"Ready to Edit",-1),e("p",{class:"text-secondary"},"Select a page or question from the sidebar to begin.",-1)])]))]),e("div",He,[e("div",Ke,[e("div",We,[s[16]||(s[16]=e("h6",{class:"card-title text-secondary text-uppercase small fw-bold mb-3"},"Survey Status",-1)),e("div",Xe,[e("span",{class:U(["badge rounded-pill px-3 py-2 me-2",u.value.is_active?"bg-success":"bg-warning text-dark"])},[e("i",{class:U(["bi me-1",u.value.is_active?"bi-check-circle-fill":"bi-cone-striped"])},null,2),h(" "+w(u.value.is_active?"LIVE":"DRAFT"),1)],2),e("small",Ye,"v"+w(u.value.version),1)]),u.value.is_active?(a(),n("div",Ze,[s[13]||(s[13]=e("div",{class:"alert alert-warning small mb-3 border-0 bg-warning bg-opacity-10 text-warning-emphasis"},[e("i",{class:"bi bi-lock-fill me-1"}),h(" Live version is locked. ")],-1)),e("button",{class:"btn btn-outline-dark w-100 shadow-sm",onClick:l},[...s[12]||(s[12]=[e("i",{class:"bi bi-pencil-square me-2"},null,-1),h(" Create Draft to Edit ",-1)])])])):(a(),n("div",et,[e("button",{class:"btn btn-success w-100 mb-2 shadow-sm text-white",onClick:v},[...s[14]||(s[14]=[e("i",{class:"bi bi-rocket-takeoff me-2"},null,-1),h(" Publish Version ",-1)])]),s[15]||(s[15]=e("p",{class:"small text-muted text-center mt-2 mb-0"}," Make this version live and collect data. ",-1))]))])])])])]))}},ot=B(tt,[["__scopeId","data-v-7ce23bbc"]]);export{ot as default};
